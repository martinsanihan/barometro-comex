d3.formatDefaultLocale({
  decimal: ',',
  thousands: '.',
  grouping: [3],
  currency: ['Bs\u00a0', ''],
  percent: '\u202f%'
});



function uniq(a, field = false) {
    let elements = [];
    $.each(a, function(k, e) {
        if (field !== false) {
            if (e[field] !== undefined) {
                elements.push(e[field]);
            }

        } else {
            elements.push(e);
        }
    });

    // Devuelve el array sin duplicados usando el objeto Set
    return [...new Set(elements)];
}

function uniq2(a,field=false){
  return [...new Set(a)];
}


function copyToClipboard(text) {

  var textArea = document.createElement( "textarea" );
  textArea.value = text;
  document.body.appendChild( textArea );       
  textArea.select();

  try {
    var successful = document.execCommand( 'copy' );
    var msg = successful ? 'successful' : 'unsuccessful';
    showSnackbar('Link copiado en su portapapeles');
  } catch (err) {
    showSnackbar('No se logró copia el link: '+text);
  }    
  document.body.removeChild( textArea );
}

/**
 * Copia el texto dado al portapapeles del usuario.
 * @param {string} text - La URL completa a copiar.
 */
function copyToClipboard(text) {
    // Apuntamos al ID de feedback que definimos en el HTML
    const feedbackElem = document.getElementById('feedback-tooltip-barometer');
    
    // Función para mostrar el feedback y ocultarlo
    const showFeedback = () => {
        if (feedbackElem) {
            feedbackElem.style.opacity = '1'; // Mostrar el tooltip
            setTimeout(() => {
                feedbackElem.style.opacity = '0'; // Ocultar después de 2 segundos
            }, 2000);
        }
    };

    if (!navigator.clipboard) {
        // --- Lógica Fallback (No cambia, solo llama a showFeedback) ---
        var textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.opacity = "0";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
            document.execCommand('copy');
            showFeedback(); // Confirma visualmente en caso de éxito
            console.log('URL copiada exitosamente (Fallback).');
        } catch (err) {
            console.error('No se pudo copiar el texto:', err);
        }
        document.body.removeChild(textArea);
        return;
    }
    
    // --- Lógica Moderna (Clipboard API) ---
    navigator.clipboard.writeText(text).then(function() {
        showFeedback(); // Confirma visualmente en caso de éxito
        console.log('URL copiada exitosamente.');
    }, function(err) {
        console.error('No se pudo copiar el texto:', err);
    });
}

function shareBarometer() {
    var obj = {};
    obj.graph = 'barometer';
    obj.title = window.myBarometerGraph.options.plugins.title.text;
    obj.labels = window.myBarometerGraph.data.labels;
    obj.dataset = window.myBarometerGraph.data.datasets;
    obj.description = $('#description-chart-barometer').html();
    
    var a = encodeObjectBase64(obj);
    copyToClipboard(window.location.origin+window.location.pathname+"#17a204b272bde0be79e2058aa9daeb86="+a);
}


function shareCharacterization() {
  var obj = {};
  obj.graph = 'characterization';
  obj.title = window.myCharacterizationGraph.options.plugins.title.text;
  obj.labels = window.myCharacterizationGraph.data.labels;
  obj.dataset = window.myCharacterizationGraph.data.datasets;
  obj.description = $('#description-chart-characterization').html();
//  obj.sources = $('#sources-chart-characterization').html();

  var a = encodeObjectBase64(obj);
  copyToClipboard(window.location.origin+window.location.pathname+"#17a204b272bde0be79e2058aa9daeb86="+a);

}


function downloadPDFBarometer() {
  var newCanvas = document.querySelector('#barometer-graph');
  var newCanvas2 = document.querySelector('#barometer-graph2');
  var newCanvasImg = newCanvas.toDataURL("image/png", 1.0);
  var newCanvasImg2 = newCanvas2.toDataURL("image/png", 1.0);
  var doc = new jsPDF('landscape');

  const originalWidth = newCanvas.width;
  const originalHeight = newCanvas.height;
  const pdfWidth = 250; 
  const pdfHeight = (originalHeight * pdfWidth) / originalWidth;

  const logoMarginY = 5; 
  const logoNewY = 10 + pdfHeight + logoMarginY;
  
  doc.setFontSize(20);
  
  doc.addImage(newCanvasImg, 'JPEG', 10, 10, pdfWidth, pdfHeight); 
  doc.addImage(newCanvasImg2, 'JPEG', 10, 10 + pdfHeight + 10, pdfWidth, pdfHeight);

  const image = new Image();
  image.src = 'data:image/png;base64,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';
  
  doc.addImage(image, 'JPEG', 230, logoNewY, 30, 12); 

  doc.save(window.myBarometerGraph.options.plugins.title.text+'.pdf');
}

function downloadPDFCharacterization() {
  var newCanvas = document.querySelector('#characterization-graph');
  var newCanvasImg = newCanvas.toDataURL("image/png", 1.0);
  var doc = new jsPDF('landscape');

  const originalWidth = newCanvas.width;
  const originalHeight = newCanvas.height;
  const pdfWidth = 250; 
  const pdfHeight = (originalHeight * pdfWidth) / originalWidth;

  const logoMarginY = 5; 
  const logoNewY = 10 + pdfHeight + logoMarginY;
  
  doc.setFontSize(20);
  
  doc.addImage(newCanvasImg, 'JPEG', 10, 10, pdfWidth, pdfHeight); 

  const image = new Image();
  image.src = 'data:image/png;base64,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';
  
  doc.addImage(image, 'JPEG', 230, logoNewY, 30, 12); 

  doc.save(window.myCharacterizationGraph.options.plugins.title.text+'.pdf');
}

function downloadJsonBarometer() {
    let filteredData = window.yearsBarometerOriginal;
    
    const selectedDimension = window.myBarometerGraph.options.plugins.title.text || null; 
    const selectedSubdimension = window.currentSubdimension || null;
    const selectedYears = window.yearsCurrent || [];

    if (filteredData && selectedDimension) {
        filteredData = filteredData.filter(d => d.dimension === selectedDimension);
    }

    if (filteredData && selectedSubdimension) {
        filteredData = filteredData.filter(d => d.subdimension === selectedSubdimension);
    }
    
    if (filteredData && selectedYears.length > 0) {
        filteredData = filteredData.filter(d => selectedYears.includes(d.anio));
    }

    
    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(filteredData, null, 2));
    
    const fileName = (window.titleGraph || "Indicadores_del_Barometro")
                     .replace(/[,\s]/g, '_')
                     .replace(/[^a-z0-9_]/gi, '')
                     + '.json';

    var dlAnchorElem = document.getElementById('downloadAnchorElem');
    dlAnchorElem.setAttribute("href", dataStr);
    dlAnchorElem.setAttribute("download", fileName);
    
    dlAnchorElem.click();
}



function downloadJsonCharacterization() {
    let filteredData = window.yearsCharacterizationOriginal;
    
    const selectedDimension = window.myCharacterizationGraph.options.plugins.title.text || null; 
    const selectedSubdimension = window.currentSubdimension || null;
    const selectedYears = window.yearsCurrent || [];

    console.log(selectedDimension);

    if (filteredData && selectedDimension) {
        filteredData = filteredData.filter(d => d.caracteristica === selectedDimension);
    }

    if (filteredData && selectedSubdimension) {
        filteredData = filteredData.filter(d => d.subdimension === selectedSubdimension);
    }
    
    if (filteredData && selectedYears.length > 0) {
        filteredData = filteredData.filter(d => selectedYears.includes(d.anio));
    }

    
    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(filteredData, null, 2));
    
    const fileName = (window.titleGraph || "Caracterización de las Empresas")
                     .replace(/[,\s]/g, '_')
                     .replace(/[^a-z0-9_]/gi, '')
                     + '.json';

    var dlAnchorElem = document.getElementById('downloadAnchorElem');
    dlAnchorElem.setAttribute("href", dataStr);
    dlAnchorElem.setAttribute("download", fileName);
    
    dlAnchorElem.click();
}



function downloadCsvBarometer() {
    // 1. Obtener los datos crudos originales
    let filteredData = window.yearsBarometerOriginal;
    
    // Asumimos que estas variables globales de filtro existen
    const selectedDimension = window.myBarometerGraph.options.plugins.title.text || null; 
    const selectedSubdimension = window.currentSubdimension || null;
    const selectedYears = window.yearsCurrent || []; // Debe ser un Array de años
    
    // console.log(selectedDimension, selectedSubdimension, selectedYears); // Línea de depuración, se puede quitar.

    // --- Lógica de Filtrado (Reutilizada del JSON) ---
    
    if (filteredData && selectedDimension) {
        filteredData = filteredData.filter(d => d.dimension === selectedDimension);
    }

    if (filteredData && selectedSubdimension) {
        filteredData = filteredData.filter(d => d.subdimension === selectedSubdimension);
    }
    
    if (filteredData && selectedYears.length > 0) {
        filteredData = filteredData.filter(d => selectedYears.includes(d.anio));
    }

    // --- CONVERSIÓN Y DESCARGA ---
    
    // 2. Convertir el array de objetos filtrados a formato CSV
    let csv = convertToCSV(filteredData); // Usa la función de ayuda

    // 3. Crear el nombre del archivo (Asegurando la extensión .csv)
    const fileName = (window.titleGraph || "Indicadores_del_Barometro")
                     .replace(/[,\s]/g, '_')
                     .replace(/[^a-z0-9_]/gi, '')
                     + '.csv'; // CAMBIO: Extensión CSV

    // 4. Descargar el archivo
    var downloadLink = document.createElement("a");
    // Usamos 'text/csv' para el tipo MIME
    var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); 
    var url = URL.createObjectURL(blob);
    
    downloadLink.href = url;
    downloadLink.download = fileName; 
    
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
}



function downloadCsvCharacterization() {
    let filteredData = window.yearsCharacterizationOriginal;
    
    // Asumimos que estas variables globales de filtro existen
    const selectedDimension = window.myCharacterizationGraph.options.plugins.title.text || null; 
    const selectedSubdimension = window.currentSubdimension || null;
    const selectedYears = window.yearsCurrent || []; // Debe ser un Array de años
    
    // console.log(selectedDimension, selectedSubdimension, selectedYears); // Línea de depuración, se puede quitar.


    // --- Lógica de Filtrado (Reutilizada del JSON) ---
    
    if (filteredData && selectedDimension) {
        filteredData = filteredData.filter(d => d.caracteristica === selectedDimension);
    }

    if (filteredData && selectedSubdimension) {
        filteredData = filteredData.filter(d => d.subdimension === selectedSubdimension);
    }
    
    if (filteredData && selectedYears.length > 0) {
        filteredData = filteredData.filter(d => selectedYears.includes(d.anio));
    }

    // --- CONVERSIÓN Y DESCARGA ---
    
    // 2. Convertir el array de objetos filtrados a formato CSV
    let csv = convertToCSV(filteredData); // Usa la función de ayuda

    // 3. Crear el nombre del archivo (Asegurando la extensión .csv)
    const fileName = (window.titleGraph || "Caracterización de las Empresas")
                     .replace(/[,\s]/g, '_')
                     .replace(/[^a-z0-9_]/gi, '')
                     + '.csv'; // CAMBIO: Extensión CSV

    // 4. Descargar el archivo
    var downloadLink = document.createElement("a");
    // Usamos 'text/csv' para el tipo MIME
    var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); 
    var url = URL.createObjectURL(blob);
    
    downloadLink.href = url;
    downloadLink.download = fileName; 
    
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
}



function convertToCSV(objArray) {
    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
    
    // 1. Verificación de seguridad: si no hay datos o no es un array, devuelve vacío.
    if (!Array.isArray(array) || array.length === 0) {
        return '';
    }

    // --- CÓDIGO CLAVE PARA GENERAR HEADERS ---
    
    // 2. Obtener las cabeceras (keys del primer objeto)
    var str = '';
    var header = Object.keys(array[0]); 
    
    // 3. Escribir la línea de cabecera separada por comas
    str += header.join(',') + '\r\n'; 

    // --- FIN CÓDIGO CLAVE ---

    // 4. Recorrer los datos y construir las filas
    for (var i = 0; i < array.length; i++) {
        var line = '';
        
        for (var index in header) {
            if (line != '') line += ',';
            
            // Obtener el valor usando el nombre de la cabecera
            let value = array[i][header[index]]; 
            
            // Manejar valores que contienen comas o saltos de línea envolviéndolos en comillas
            if (typeof value === 'string' && (value.includes(',') || value.includes('\n'))) {
                line += `"${value.replace(/"/g, '""')}"`; // Escapa comillas internas
            } else {
                // Asegura que los valores nulos/undefined se traten como vacío
                line += value !== null && value !== undefined ? value : '';
            }
        }
        str += line + '\r\n';
    }
    return str;
}




function normalizeString(string) {
  return string
  .split('')
  .map(
    function(letter) {
      let i = this.accents.indexOf(letter);
      return i !== -1 ? this.out[i] : letter;
    }.bind({
      accents:
      'ÀÁÂÃÄÅĄàáâãäåąßÒÓÔÕÕÖØÓòóôõöøóÈÉÊËĘèéêëęðÇĆçćÐÌÍÎÏìíîïÙÚÛÜùúûüÑŃñńŠŚšśŸÿýŽŻŹžżź',
      out:
      'AAAAAAAaaaaaaaBOOOOOOOOoooooooEEEEEeeeeeeCCccDIIIIiiiiUUUUuuuuNNnnSSssYyyZZZzzz'
    })
    )
  .join('');
}

function onlyUnique(value, index, self) {
  return self.indexOf(value) === index;
}
function toTitle(str, formatStrExceptions) {
  if (formatStrExceptions && formatStrExceptions.indexOf(str) > -1) {
    return str;
  }
  var formatStr = str.toLowerCase();
  formatStr = formatStr.replace(/[-_\s]/g, ' ');
  return formatStr.charAt(0).toUpperCase() + formatStr.substr(1);
}

function toCamelCase(str) {
  var formatStr = normalizeString(str).toLowerCase();
  formatStr = formatStr.replace(/[-_\s]+(.)?/g, function(_match, ch) {
    return ch ? ch.toUpperCase() : '';
  });
  return formatStr.substr(0, 1).toLowerCase() + formatStr.substr(1);
}

function titleCase(str) {
  var splitStr = str.toLowerCase().split(' ');
  for (var i = 0; i < splitStr.length; i++) {
    splitStr[i] =
    splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);
  }
  return splitStr.join(' ');
}

function find(needle, haystack) {
  var results = [];
  var idx = haystack.indexOf(needle);
  while (idx != -1) {
    results.push(idx);
    idx = haystack.indexOf(needle, idx + 1);
  }
  return results;
}

function ninToZero(value) {
  if (value) {
    return value;
  }
  return 0;
}

function extractColumnName(column) {
  return { name: toCamelCase(column.fStr).toLowerCase(), header: column.fHeader };
}

function extractKeyValues(response, indexes) {
  var header = response.data.result.fArray.filter(function(d) {
    return d.fHeader == true;
  });
  var data = response.data.result.fArray.filter(function(d) {
    return d.fHeader !== true;
  });

  result = [];
  result.columns = header.map(function(d) {
    return extractValue(d);
  });
  data.forEach(function(entry, index) {
    if (index % indexes === 0) {
      jsonString = '{';
      for (var i = 0; i < indexes; i++) {
        jsonString +=
        '"' +
        extractValue(header[i]) +
        '":"' +
        extractValue(data[index + i]) +
        '",';
      }
      jsonString = jsonString.substring(0, jsonString.length - 1) + '}';
      result.push(JSON.parse(jsonString));
    }
  });
  return result;
}

function groupBy(array, groups, valueKey) {
  var map = new Map();
  groups = [].concat(groups);
  return array.reduce((r, o) => {
    var valueNumber = parseFloat(o[valueKey], 10);
    if (valueNumber) {
      groups.reduce((m, k, i, { length }) => {
        var child;
        if (m.has(o[k])) return m.get(o[k]);
        if (i + 1 === length) {
          child = Object.assign(...groups.map(k => ({ [k]: o[k] })), {
            [valueKey]: 0
          });
          r.push(child);
        } else {
          child = new Map();
        }
        m.set(o[k], child);
        return child;
      }, map)[valueKey] += +valueNumber;
    }
    return r;
  }, []);
}

function formatColumnText(text) {
  s = text.replace(/_/g, ' ');
  return s && s[0].toUpperCase() + s.slice(1).toLowerCase();
}

function filterData(dataList, dataKey, value, dataFormatter) {
  if (value) {
    return dataFormatter(
      dataList.filter(function(item) {
        return item[dataKey] === value;
      })
      );
  }
  return dataFormatter(dataList);
}

function fillSelectFilter(selector, list, onChange, defaultValue) {
  select = document.querySelector(selector);
  select.addEventListener('change', function(event) {
    var value = event.target.value;
    onChange(value);
  });
  list.forEach(function(item) {
    var labe = item.label;
    var value = item.value;
    var opt = document.createElement('option');
    opt.appendChild(document.createTextNode(labe));
    opt.value = value;
    if (defaultValue === value) opt.selected = 'selected';
    select.appendChild(opt);
  });
}

function arrayListFromData(dataList, dataKey, labelFormatter) {
  var safeLabelFormatter =
  labelFormatter ||
  function(value) {
    return value;
  };
  return dataList
  .reduce(function(accum, current) {
    if (
      !accum.some(function(item) {
        return item.value === current[dataKey];
      })
      ) {
      accum.push({
        label: safeLabelFormatter(current[dataKey]),
        value: current[dataKey]
      });
  }
  return accum;
}, [])
  .sort(sortList);
}

function sortList(a, b) {
  if (a.value > b.value) {
    return 1;
  }
  if (a.value < b.value) {
    return -1;
  }
  return 0;
}

function extractValue(item) {
  var valueType = item.fType;
  switch (valueType) {
    case 'TEXT':
    return item.fStr;
    case 'NUMBER':
    return item.fNum;
    case 'DATE':
    var d = new Date(0);
    d.setUTCMilliseconds(item.fNum);
    return d;
    default:
    return item.fStr;
  }
}

function makeRow(values, columnsName) {
  var finalRow = {};
  values.forEach(function(item, index) {
    finalRow[toCamelCase(columnsName[index].name)] = extractValue(item);
  });
  return finalRow;
}

function makeRowSecondStrategy(values, columnsName) {
  var finalRow = {};
  values.forEach(function(item, index) {
    finalRow[toCamelCase(columnsName[index].name)] = item;
  });
  return finalRow;
}

function transformDataArraySecondStrategy(responseData) {
  var tableData = responseData.result;
  var headers = tableData.shift();
  var totalCols = headers.length;
  var totalRows = 0;
  var columnNames = headers.map(function(n) {
    return {
      name: toCamelCase(n).toLowerCase(),
      heder: true
    };
  });
  var dataArray = tableData.map(function(data) {
    totalRows++;
    return makeRowSecondStrategy(data, columnNames);
  });
  return {
    totalCols: totalCols,
    totalRows: totalRows,
    columnNames: columnNames,
    dataArray: dataArray
  };
}

function transformDataArray(responseData) {
  //extraer datos del json de la API
  try {
    var tableData = responseData.result;
    var totalCols = tableData.fCols; // num cols
    var totalRows = tableData.fRows; //num rows
    var array = tableData.fArray; //actual data
    var columnNames = array.slice(0, totalCols).map(extractColumnName);
    var arrayData = array.slice(totalCols, array.length);
    var finalData = [];
    for (var i = 0; i < arrayData.length; i += totalCols) {
      finalData.push(makeRow(arrayData.slice(i, i + totalCols), columnNames));
    }
    return {
      totalCols: totalCols,
      totalRows: totalRows,
      columnNames: columnNames,
      dataArray: finalData
    };
  } catch (e) {
    return transformDataArraySecondStrategy(responseData);
  }
}

function accumulateByKey(data, filterKey, filterValue, valueKey) {
  return data.reduce(function(acc, d) {
    if (normalizeString((d[filterKey]).toLowerCase()) === normalizeString((filterValue).toLowerCase())) {
      var val = d[valueKey];
      if (typeof val === 'number') return acc + val;
      return acc + parseFloat((val || '0').replace(/,/g, '.'));
    }
    return acc;
  }, 0);
}

function randomString() {
  return (
    Math.random()
    .toString(36)
    .substring(2, 15) +
    Math.random()
    .toString(36)
    .substring(2, 15)
    );
}

var bubbleSort = a => {
  let swapped;
  do {
    swapped = false;
    a.forEach((el, ind, arr) => {
      if (ind != arr.length - 1) {
        if (el.date > arr[ind + 1].date) {
          var temp = arr[ind];
          arr[ind] = arr[ind + 1];
          arr[ind + 1] = temp;
          swapped = true;
        }
      }
    });
  } while (swapped);
};

function formatNumber(arg) {
  try {
    var formatter = new Intl.NumberFormat('es-CL', {
      style: 'decimal',
      maximumFractionDigits: 2
    });
    var result = formatter.format(arg);
    if (isNaN(arg)) throw new Error('is NaN');
    return result;
  } catch (error) {
    return arg;
  }
}

function insertLabels(
  selector,
  data,
  colors,
  valuePrefix,
  valueSuffix,
  formatter,
  formatterExceptions
  ) {
  if (!formatter) {
    formatter = formatNumber;
  }
  if (Array.isArray(data)) {
    var labels = {};
    data.forEach(function(d) {
      var t = d.type;
      var r = {
        type: t,
        qtty: d.qtty
      };
      labels[t] = r;
    });
    data = labels;
  }
  $(selector).empty();
  Object.keys(data).forEach(function(label, i) {
    var lastPart;
    if (data[label].qtty)
      lastPart =
    ': ' +
    valuePrefix +
    '' +
    formatter(data[label].qtty) +
    '' +
    valueSuffix;
    else lastPart = '';
    var child =
    '<div class="label"><div class="color-box d-inline-block" style="background-color: ' +
    colors[i] +
    '"></div>' +
    toTitle(label, formatterExceptions) +
    lastPart;
    ('</div>');
    document.querySelector(selector).insertAdjacentHTML('beforeend', child);
  });
}

function insertLabelsWithFlags(
  selector,
  data,
  colors,
  valuePrefix,
  valueSuffix,
  formatter
  ) {
  var formatterExceptions = ['USA'];
  insertLabels(
    selector,
    data,
    colors,
    valuePrefix,
    valueSuffix,
    formatter,
    formatterExceptions
    );
  $(selector + ' > .label').each(function(index, childLabel) {
    var d = data[index];
    if (!d.flag) return;
    var img = countryToFlag(d.flag);
    $(childLabel).prepend(
      '<img class="label-flag" src="../../../flags/' +
      img +
      '.png" alt="' +
      d.type +
      ' " />'
      );
  });
}

function arrayWithRange(min, max) {
  var ret = new Array(max - min);

  for (var i = 0; i < ret.length; i++) {
    ret[i] = min + i;
  }
  return ret;
}

function numberToMonth(n) {
  switch (parseInt(n)) {
    case 1:
    return 'Enero';
    case 2:
    return 'Febrero';
    case 3:
    return 'Marzo';
    case 4:
    return 'Abril';
    case 5:
    return 'Mayo';
    case 6:
    return 'Junio';
    case 7:
    return 'Julio';
    case 8:
    return 'Agosto';
    case 9:
    return 'Septiembre';
    case 10:
    return 'Octubre';
    case 11:
    return 'Noviembre';
    case 12:
    return 'Diciembre';
  }
}

function shortenLabels(label) {
  switch (label) {
    case 'Agropecuario-silvícola y pesquero':
    return 'ASP';
    case 'Arica y Parinacota':
    return 'Arica';
    case 'Metropolitana de Santiago':
    return 'Metropolitana';
    case "Libertador General Bernardo O'Higgins":
    return "O'Higgins";
    case 'Aisén del General Carlos Ibáñez del Campo':
    return 'Aisén';
    case 'Aysén del General Carlos Ibáñez del Campo':
    return 'Aisén';
    case 'Magallanes y de la Antártica Chilena':
    return 'Magallanes';
    case 'Magallanes y la Antártica Chilena':
    return 'Magallanes';

    default:
    return label;
  }
}

var sortedRegionsNumbers = [
'XV',
'I',
'II',
'III',
'IV',
'V',
'XIII',
'RM',
'VI',
'VII',
'XVI',
'VII',
'VIII',
'IX',
'XIV',
'X',
'XI',
'XII'
];

function regionNumberToName(n) {
  switch (n) {
    case 'XI':
    return 'Aysén del General Carlos Ibáñez del Campo';
    case 'II':
    return 'Antofagasta';
    case 'XV':
    return 'Arica y Parinacota';
    case 'III':
    return 'Atacama';
    case 'VIII':
    return 'Biobío';
    case 'IV':
    return 'Coquimbo';
    case 'IX':
    return 'La Araucanía';
    case 'VI':
    return "Libertador General Bernardo O'Higgins";
    case 'X':
    return 'Los Lagos';
    case 'XIV':
    return 'Los Ríos';
    case 'XII':
    return 'Magallanes y la Antártica Chilena';
    case 'VII':
    return 'Maule';
    case 'XIII':
    return 'Metropolitana de Santiago';
    case 'I':
    return 'Tarapacá';
    case 'V':
    return 'Valparaíso';
    case 'XVI':
    return 'Ñuble';
    default:
    return n;
  }
}

function getPIB(data) {
  pib = [];
  for (var i = 0; i < data.length; i++) {
    item = data[i];
    switch (item.PERÍODO) {
      case 'Enero-Marzo':
      item['periodo_ind'] = 0;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Febrero-Abril':
      item['periodo_ind'] = 1;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Marzo-Mayo':
      item['periodo_ind'] = 2;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Abril-Junio':
      item['periodo_ind'] = 3;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Mayo-Julio':
      item['periodo_ind'] = 4;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Junio-Agosto':
      item['periodo_ind'] = 5;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Julio-Septiembre':
      item['periodo_ind'] = 6;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Agosto-Octubre':
      item['periodo_ind'] = 7;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Septiembre-Noviembre':
      item['periodo_ind'] = 8;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Octubre-Diciembre':
      item['periodo_ind'] = 9;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Noviembre-Enero':
      item['periodo_ind'] = 10;
      item['date'] = new Date(item.AÑO, item.periodo_ind);
      break;
      case 'Diciembre-Febrero':
      item['periodo_ind'] = 11;
      item['date'] = new Date(item.AÑO - 1, item.periodo_ind);
      break;
    }
    pib.push(item);
  }
  bubbleSort(pib);
  return pib;
}

function countryToFlag(country) {
  switch (country) {
    case 'usa':
    return 'usa';
    case 'uk':
    return 'uk';
    case 'ned':
    return 'holanda';
    case 'cn':
    return 'china';
    case 'cor':
    return 'coreasur';
    case 'can':
    return 'canada';
    case 'jpn':
    return 'japon';
    case 'ger':
    return 'alemania';
    case 'tai':
    return 'taiwan';
    case 'hk':
    return 'hongkong';
    case 'otros':
    return 'todos';
    case 'mex':
    return 'mexico';
    case 'arg':
    return 'argentina';
    case 'esp':
    return 'españa';
    case 'bra':
    return 'brasil';
    case 'ita':
    return 'italia';
    case 'par':
    return 'paraguay';
    case 'uru':
    return 'uruguay';
    case 'isr':
    return 'israel';
    case 'ind':
    return 'india';
    case 'bul':
    return 'bulgaria';
    case 'den':
    return 'dinamarca';
    case 'col':
    return 'colombia';
    case 'fra':
    return 'francia';
  }
}

function accumulateByTwoKeys(
  data,
  filterKey1,
  filterValue1,
  filterKey2,
  filterValue2,
  valueKey
  ) {
  return data.reduce(function(acc, d) {
    if (d[filterKey1] === filterValue1 && d[filterKey2] === filterValue2) {
      var val = d[valueKey];
      if (typeof val === 'number') return acc + val;
      return acc + parseFloat((val || '0').replace(/,/g, ''));
    }
    return acc;
  }, 0);
}

function barWidth(cols) {
  w = $(document).width();
  if (w === 0) return 500;
  if (w < 576) return w * 0.94;
  switch (cols) {
    case 4:
    return (w * 0.95) / 2;
    case 5:
    return (w * 0.95) / 1.5;
    case 6:
    return w * 0.9;
    case 7:
    return w * (0.9 * 1.1);
    default:
    return w;
  }
}

function legacyBarWidth(cols) {
  w = $(window).width();
  if (w < 576) return w;
  if (cols == 6) {
    return (w * 0.9) / 2;
  }
  if (cols == 4) {
    return (w * 0.95) / 2;
  }
  return w / 2;
}

function getParamValue(paramName) {
  var url = window.location.search.substring(1); //get rid of "?" in querystring
  var qArray = url.split('&'); //get key-value pairs
  for (var i = 0; i < qArray.length; i++) {
    var pArr = qArray[i].split('='); //split key and value
    if (pArr[0] == paramName) return pArr[1]; //return value
  }
}

function prepareDataToGraphDonut(
  dataList,
  dataKeyType,
  dataKeyQtty,
  formatterQtty,
  formatterType
  ) {
  var safeFormatterQtty =
  formatterQtty ||
  function(value) {
    return value;
  };
  var safeFormatterType =
  formatterType ||
  function(value) {
    return value;
  };
  return dataList.reduce(function(accum, current) {
    var currentQtty = safeFormatterQtty(current[dataKeyQtty]);
    var currentType = safeFormatterType(current[dataKeyType]);
    if (!accum[currentType]) {
      accum[currentType] = {
        type: currentType,
        qtty: currentQtty
      };
    } else {
      accum[currentType].qtty += currentQtty;
    }
    return accum;
  }, {});
}

function wrapD3Texts(text, width) {
  var words = text
  .text()
  .split(/\s+/)
  .reverse(),
  word,
  line = [],
  lineNumber = 0,
  lineHeight = 0.5, // ems
  y = text.attr('y'),
  x = text.attr('x'),
  dy = parseFloat(text.attr('dy')),
  tspan = text
  .text(null)
  .append('tspan')
  .attr('x', x)
  .attr('y', y)
  .attr('dy', dy + 'em');
  while ((word = words.pop())) {
    line.push(word);
    tspan.text(line.join(' '));
    if (tspan.node().getComputedTextLength() > width) {
      line.pop();
      tspan.text(line.join(' '));
      line = [word];
      tspan = text
      .append('tspan')
      .attr('x', x)
      .attr('y', y)
      .attr('dy', ++lineNumber * lineHeight + dy + 'em')
      .text(word);
    }
  }
}

function transformGraphDataToLabelData(data) {
  return data.map(function(d) {
    return {
      type: d.label,
      qtty: formatNumber(d.value)
    };
  });
}

function transformGraphDataToLabelDataMultibar(data, label, value) {
  return data.map(function(d) {
    return {
      type: d[label],
      qtty: formatNumber(d[value])
    };
  });
}

function renderRemoteActionsMenu(src) {
  if (getParamValue('showmenu') === '0') return;
  var onClick = function() {
    var menuButton = document.getElementById('dropdownMenuButton');
    menuButton.className = menuButton.className.replace(/\bactive\b/g, '');
  };
  var buttons = [
  downloadGraphs(onClick)
  ];
  addIconSiteSigning();
}





function downloadGraphs(onClick) {
  var btnDownload = $(
    '<a class="dropdown-item" href="#">Descargar Gráfico</a>'
    );

  btnDownload.on('click', function(event) {
    var element = document.querySelector('body');
    var virtualLik = $("<a style='display:block;'></a>");
    html2canvas(element, {
      ignoreElements: function(element) {
        var id = element.id;
        var tag = element.tagName;
        return tag === 'DIV' && id === 'dropdown-menu-remote-actions';
      }
    }).then(function(canvas) {
      var imgData = canvas.toDataURL('image/png');
      virtualLik.attr('href', imgData);
      virtualLik.attr('download', uuid4() + '.png');
      virtualLik.attr('target', 'blank');
      $('body').append(virtualLik);
      virtualLik[0].click();
      virtualLik.remove();
    });
    onClick();
  });
  return btnDownload;
}


function addIconSiteSigning() {
  var body = document.querySelector('body');
  var backgroundImage = window.location.host.includes("localhost") || window.location.host == "" ? `url("https://apimtt.files.resit.cl/assets/frontend-graficos/ObservatorioLogistico_Positivo_optimized.png")` : `url("https://${window.location.host}/assets/frontend-graficos/ObservatorioLogistico_Positivo_optimized.png")`;
  body.setAttribute(
    'style',
    [
    // 'background-image: url(data:image/png;base64,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)',
    // old logo
    // 'background-image: url(data:image/png;base64,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)',
    // 'background-image: url("./ComplementoLogotipo_ObservatorioLogistico_Positivo.svg")', 
    // 'background-image: url("https://nuevo.observatoriologistico.cl/49a14d83462e7dfda375ef304b4a4407.svg")',
    `background-image: ${backgroundImage}`,
    'background-position: bottom right',
    'background-repeat: no-repeat',
    'background-attachment: fixed',
    'background-size: 90px',
    'height: 100vh'
    ].join(';')
    );
}

function registerComparerListener() {
  // Graph comparer listener
  var eventMethod = window.addEventListener
  ? 'addEventListener'
  : 'attachEvent';
  var eventer = window[eventMethod];
  var messageEvent = eventMethod == 'attachEvent' ? 'onmessage' : 'message';

  var parentUrl =
  window.location != window.parent.location
  ? document.referrer
  : document.location.href;
  // Listen to message from child window
  eventer(
    messageEvent,
    function(e) {
      if (e.data === "show"){
        let i = 0;
        while (i < 10) {
          if (i === 0) {
            try{
              document.getElementById("url").style.display = "block";
              document.getElementById("helpUrl").style.display = "block";
            } catch {
              //console.log("Url not found");
            }
          }
          try {
            document.getElementById("url" + i.toString()).style.display = "block";
            document.getElementById("helpUrl" + i.toString()).style.display = "block";
          } catch {
            //console.log("Url not found");
          }
          i += 1
        }
      }
      if (parentUrl.includes('http://localhost:3000'))
        parent.postMessage(e.data, 'http://localhost:3000');
      if (parentUrl.includes('https://observatorio.resit.cl'))
        parent.postMessage(e.data, 'http://observatorio.resit.cl');
      if (parentUrl.includes('https://nuevo.observatoriologistico.cl'))
        parent.postMessage(e.data, 'https://nuevo.observatoriologistico.cl');
      if (parentUrl.includes('https://www.observatoriologistico.cl'))
        parent.postMessage(e.data, 'https://www.observatoriologistico.cl');
    },
    false
    );
}

function uuid4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = (Math.random() * 16) | 0;
    var v = c === 'x' ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

function truncateTabTitles() {
  if (window.innerWidth < 400) {
    $('.nav-item a').text(function() {
      return $(this)
      .text()
      .replace('Dato de Interés', 'Dato');
    });
  }
}

$(document).ready(function() {
  truncateTabTitles();
});

function TransformTextToSlug(text) {
  return (text || '').toLowerCase().replace(/ /g, '-');
}

function formatterIframeInterestingData() {
  document.querySelectorAll('iframe').forEach(function(iframe) {
    var iframeConfig = iframe.dataset;
    iframe.style = iframeConfig.style || 'border: none; overflow: hidden;';
    iframe.width = iframe.width || '100%';
    iframe.height = iframe.height || '800px';
    iframe.scrolling = iframe.scrolling || 'no';
  });
}

var getDataUrl = function(img, type) {
  var canvas = document.createElement('canvas');
  var ctx = canvas.getContext('2d');

  canvas.width = img.width;
  canvas.height = img.height;
  ctx.drawImage(img, 0, 0);
  return canvas.toDataURL(type);
};

function afterInterestingDataLoad() {
  formatterIframeInterestingData();
  localStorage.setItem('AXIOS_REGISTER_URL', '[]');
}

function registerAxiosEventListener(element, onAllFinish) {
  element.addEventListener('AXIOS_REGISTER_REQUEST_EVENT', function(event) {
    const url = event.detail.url;
    const currentList =
    JSON.parse(localStorage.getItem('AXIOS_REGISTER_URL')) || [];
    if (!currentList.includes(url)) {
      currentList.push(url);
    }
    localStorage.setItem('AXIOS_REGISTER_URL', JSON.stringify(currentList));
  });

  element.addEventListener('AXIOS_REGISTER_RESPONSE_EVENT', function(event) {
    const url = event.detail.url;
    const currentList = (
      JSON.parse(localStorage.getItem('AXIOS_REGISTER_URL')) || []
      ).filter(function(item) {
        return item !== url;
      });
      if (currentList.length === 0) {
        onAllFinish();
        truncateTabTitles();
      }
      localStorage.setItem('AXIOS_REGISTER_URL', JSON.stringify(currentList));
    });
}

function createCustomAxiosEvent(name, url) {
  const event = new CustomEvent(name, {
    detail: {
      url: url
    }
  });
  return event;
}

function onAllAxiosRequestFinish() {
  const data = {
    dataType: 'mtt-data',
    graphAction: 'ALL-AXIOS-REQUEST-FINISH'
  };
}

function onGraphLoadingFinish() {
  const data = {
    dataType: 'mtt-data',
    graphAction: 'GRAPH-LOADING-FINISH'
  };
}

function onGraphLoadingFailed() {
  const data = {
    dataType: 'mtt-data',
    graphAction: 'GRAPH-LOADING-FAILED'
  };
}

function registerAxiosInterceptors() {
  // Add a request interceptor
  const html = document.querySelector('html');
  registerAxiosEventListener(html, onAllAxiosRequestFinish);
  if (typeof axios === 'undefined') return;
  axios.interceptors.request.use(
    function(config) {
      html.dispatchEvent(
        createCustomAxiosEvent('AXIOS_REGISTER_REQUEST_EVENT', config.url)
        );
      return config;
    },
    function(error) {
      return Promise.reject(error);
    }
    );

  // Add a response interceptor
  axios.interceptors.response.use(
    function(response) {
      html.dispatchEvent(
        createCustomAxiosEvent(
          'AXIOS_REGISTER_RESPONSE_EVENT',
          response.config.url
          )
        );
      return response;
    },
    function(error) {
      return Promise.reject(error);
    }
    );
}



function getUrl(guId) {
  return (
    ' https://api.datos.observatoriologistico.cl/api/v2/datastreams/' +
    guId +
    '/data.json/?auth_key=edeb2a180a082b066c32f687bcb1bdfaf49e56b6'
    );
}
function XXXgetUrl(guId) { // Función para dev
  if (guId == 'INDIC-DEL-BAROM-DE-LA')
    return "http://127.0.0.1:3000/json/barometer.json";
  else
    return "http://127.0.0.1:3000/json/caracterizacion.json";
  }

//Global--

registerComparerListener();
registerAxiosInterceptors();

//--Global
